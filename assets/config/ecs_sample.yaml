---
executionRoleArn: arn:aws:iam::002417289773:role/dash_ecs_staging

containerDefinitions:
- logConfiguration:
    logDriver: awslogs
    secretOptions:
    options:
      awslogs-group: dash
      awslogs-region: us-east-1
      awslogs-stream-prefix: dash/app
  entryPoint:
  portMappings:
  - hostPort: 3000
    protocol: tcp
    containerPort: 3000
  command:
  - rails
  - staging
  cpu: 0
  environment:
  - name: APPLICATION_DOMAIN
    value: track2883.testing.siftery.com
  - name: AUTH_PROXY_DOMAIN
    value: https://auth-proxy.testing.siftery.com/users/auth/google/callback
  - name: AV_HOSTNAME
    value: av.dash.testing
  - name: DB_HOST
    value: dash-testing.cdcqpkmeyjz2.us-east-1.rds.amazonaws.com
  - name: DB_NAME
    value: dash_stg2
  - name: ENABLE_NR
    value: 'false'
  - name: JOB_WORKER_URL
    value: redis://127.0.0.1:6379/0
  - name: RAILS_ENV
    value: staging
  mountPoints:
  - readOnly:
    containerPath: "/opt/dash"
    sourceVolume: app
  - readOnly:
    containerPath: "/opt/dash/log/custom_upload_files"
    sourceVolume: app_data
  memory:
  memoryReservation: 128
  stopTimeout: 30
  image: '002417289773.dkr.ecr.us-east-1.amazonaws.com/dash-test:dev-lubdhak_workspace_injector_fix'
  startTimeout: 30
  dependsOn:
  healthCheck:
  essential: false
  name: app


- logConfiguration:
    logDriver: awslogs
    secretOptions:
    options:
      awslogs-group: dash
      awslogs-region: us-east-1
      awslogs-stream-prefix: dash/worker
  entryPoint:
  portMappings: []
  command:
  - sidekiq
  - staging
  cpu: 0
  environment:
  - name: APPLICATION_DOMAIN
    value: track2883.testing.siftery.com
  - name: AUTH_PROXY_DOMAIN
    value: https://auth-proxy.testing.siftery.com/users/auth/google/callback
  - name: AV_HOSTNAME
    value: av.dash.testing
  - name: DB_HOST
    value: dash-testing.cdcqpkmeyjz2.us-east-1.rds.amazonaws.com
  - name: DB_NAME
    value: dash_stg2
  - name: ENABLE_NR
    value: 'false'
  - name: JOB_WORKER_URL
    value: redis://127.0.0.1:6379/0
  - name: RAILS_ENV
    value: staging
  mountPoints:
  - readOnly:
    containerPath: "/opt/dash/log/custom_upload_files"
    sourceVolume: app_data
  memory:
  memoryReservation: 128
  stopTimeout: 30
  image: '002417289773.dkr.ecr.us-east-1.amazonaws.com/dash-test:dev-lubdhak_workspace_injector_fix'
  startTimeout: 30
  dependsOn:
  healthCheck:
  essential: false
  name: worker
- logConfiguration:
    logDriver: awslogs
    secretOptions:
    options:
      awslogs-group: dash
      awslogs-region: us-east-1
      awslogs-stream-prefix: dash/console
  entryPoint:
  portMappings:
  - hostPort: 22
    protocol: tcp
    containerPort: 22
  command:
  - console
  - staging
  cpu: 0
  environment:
  - name: APPLICATION_DOMAIN
    value: track2883.testing.siftery.com
  - name: AUTH_PROXY_DOMAIN
    value: https://auth-proxy.testing.siftery.com/users/auth/google/callback
  - name: AV_HOSTNAME
    value: av.dash.testing
  - name: DB_HOST
    value: dash-testing.cdcqpkmeyjz2.us-east-1.rds.amazonaws.com
  - name: DB_NAME
    value: dash_stg2
  - name: ENABLE_NR
    value: 'false'
  - name: JOB_WORKER_URL
    value: redis://127.0.0.1:6379/0
  - name: RAILS_ENV
    value: staging
  mountPoints:
  - readOnly:
    containerPath: "/opt/dash/log/custom_upload_files"
    sourceVolume: app_data
  memory:
  memoryReservation: 128
  stopTimeout: 30
  image: '002417289773.dkr.ecr.us-east-1.amazonaws.com/dash-test:dev-lubdhak_workspace_injector_fix'
  startTimeout: 30
  healthCheck:
  essential: false
  name: console
- logConfiguration:
    logDriver: awslogs
    secretOptions:
    options:
      awslogs-group: dash
      awslogs-region: us-east-1
      awslogs-stream-prefix: dash/cache
  entryPoint:
  portMappings: []
  command:
  cpu: 0
  environment: []
  mountPoints: []
  memory:
  memoryReservation: 128
  stopTimeout: 30
  image: redis:latest
  startTimeout: 30
  healthCheck:
  essential: false
  name: cache
- logConfiguration:
    logDriver: awslogs
    secretOptions:
    options:
      awslogs-group: dash
      awslogs-region: us-east-1
      awslogs-stream-prefix: dash/web
  entryPoint:
  portMappings:
  - hostPort: 80
    protocol: tcp
    containerPort: 80
  command:
  cpu: 0
  environment:
  - name: APP_HOSTNAME
    value: 127.0.0.1
  - name: ENABLE_CDN
    value: 'false'
  - name: ENABLE_SSL
    value: 'true'
  - name: WEB_HOSTNAME
    value: dash.siftery.com
  mountPoints:
  - readOnly:
    containerPath: "/opt/dash"
    sourceVolume: app
  memory:
  memoryReservation: 128
  stopTimeout: 30
  image: '002417289773.dkr.ecr.us-east-1.amazonaws.com/dash-web:latest'
  startTimeout: 30
  healthCheck:
  essential: true
  name: web

memory: '16384'
taskRoleArn: arn:aws:iam::002417289773:role/dash_ecs_staging
taskDefinitionArn: arn:aws:ecs:us-east-1:002417289773:task-definition/testing_dash_stack:363
family: testing_yantra
requiresCompatibilities:
- FARGATE
networkMode: awsvpc
cpu: '4096'
volumes:
- fsxWindowsFileServerVolumeConfiguration:
  efsVolumeConfiguration:
  name: app_data
  host:
    sourcePath:
  dockerVolumeConfiguration:
- fsxWindowsFileServerVolumeConfiguration:
  efsVolumeConfiguration:
  name: app
  host:
    sourcePath:
  dockerVolumeConfiguration:
